\def\RSUlineYShift{2}
\def\RSUlineWidth{1.25}

\tikzset{%
    RSCage/.style={
        inner sep=0pt,
        outer sep=0pt,
    },
    RSUline/.style={
        line width=\RSUlineWidth pt,
        % inner sep=0pt,
        % outer sep=0pt,
        % overlay
    },
}


\definecolor{RSSubjectColor}{HTML}{673ab7}
\definecolor{RSPredicateColor}{HTML}{e81e62}
\definecolor{RSAttributeColor}{HTML}{2196f3}
\definecolor{RSAdverbarialColor}{HTML}{009688}
\definecolor{RSObjectColor}{HTML}{ffa500}


% ==============================================
% =========== Subject (подлежащее) =============
% ==============================================

    % Underline subject.
    \NewDocumentCommand{\rsUnderlineSubject}{ O{black} m }{%
        \tikz[baseline=(Root.base)]{%
            \node[RSCage] (Root) {\downVPhantom#2};
            \draw[#1, RSUline]
                ([yshift=-\RSUlineYShift pt]Root.south west) --
                ([yshift=-\RSUlineYShift pt]Root.south east);
        }%
    }

    \NewDocumentCommand{\rsSubject}{ s m }{%
        \rsUnderlineSubject
            [\IfBooleanTF{#1}{RSSubjectColor}{}]
            {\ProcessMap{\textoverset}{#2}[ ]}%
    }


% ==============================================
% =========== Predicate (сказуемое) ============
% ==============================================

    % Underline predicate.
    \NewDocumentCommand{\rsUnderlinePredicate}{ O{black} m }{%
        \tikz[baseline=(Root.base)]{%
            \node[RSCage] (Root) {\downVPhantom#2};
            \draw[#1, RSUline]
                ([yshift=-\RSUlineYShift pt]Root.south west) --
                ([yshift=-\RSUlineYShift pt]Root.south east);
            \draw[#1, RSUline]
                ([yshift=-\RSUlineYShift - 2 pt]Root.south west) --
                ([yshift=-\RSUlineYShift - 2 pt]Root.south east);
        }%
    }

    \NewDocumentCommand{\rsPredicate}{ s m }{%
        \rsUnderlinePredicate
            [\IfBooleanTF{#1}{RSPredicateColor}{}]
            {\ProcessMap{\textoverset}{#2}[ ]}%
    }


% ==============================================
% ======== Adverbarial (обстоятельство) ========
% ==============================================

    % Underline predicate.
    \NewDocumentCommand{\rsUnderlineAdverbarial}{ O{black} m }{%
        \tikz[baseline=(Root.base)]{%
            \node[RSCage] (Root) {\downVPhantom#2};
            \draw[
                #1,
                RSUline,
                dash pattern={on 5pt off 2pt on 1.5pt off 2pt},
            ]
                ([yshift=-\RSUlineYShift pt]Root.south west) --
                ([yshift=-\RSUlineYShift pt]Root.south east);
        }%
    }

    \NewDocumentCommand{\rsAdverbarial}{ s m }{%
        \rsUnderlineAdverbarial
            [\IfBooleanTF{#1}{RSAdverbarialColor}{}]
            {\ProcessMap{\textoverset}{#2}[ ]}%
    }
    
    
% ==============================================
% ======== Attribute (определение) =============
% ==============================================

    % Underline predicate.
    \NewDocumentCommand{\rsUnderlineAttribute}{ O{black} m }{%
        \tikz[baseline=(Root.base)]{%
            \node[RSCage] (Root) {\downVPhantom#2};
            \draw[
                #1,
                RSUline,
                decorate,
                decoration={
                    complete sines,
                    segment length=2.75pt,
                    amplitude=1.75,
                    mirror,
                    start up,
                    end down
                }
            ]
                ([yshift=-\RSUlineYShift pt]Root.south west) --
                ([yshift=-\RSUlineYShift pt]Root.south east);
        }%
    }

    \NewDocumentCommand{\rsAttribute}{ s m }{%
        \rsUnderlineAttribute
            [\IfBooleanTF{#1}{RSAttributeColor}{}]
            {\ProcessMap{\textoverset}{#2}[ ]}%
    }


% ==============================================
% ======== Adverbarial (обстоятельство) ========
% ==============================================

    % Underline predicate.
    \NewDocumentCommand{\rsUnderlineObject}{ O{black} m }{%
        \tikz[baseline=(Root.base)]{%
            \node[RSCage] (Root) {\downVPhantom#2};
            \draw[
                #1,
                RSUline,
                dash pattern={on 5pt off 2pt on 1pt off 0pt},
            ]
                ([yshift=-\RSUlineYShift pt]Root.south west) --
                ([yshift=-\RSUlineYShift pt]Root.south east);
        }%
    }

    \NewDocumentCommand{\rsObject}{ s m }{%
        \rsUnderlineObject
            [\IfBooleanTF{#1}{RSObjectColor}{}]
            {\ProcessMap{\textoverset}{#2}[ ]}%
    }


\NewDocumentCommand{\Noun}{ O{} m }{
    \ifblank{#1}{%
        \textoverset{#2}{\rsverb}
    }{%
        \textoverset{#2}{\NOUN, #1}
    }
}


\NewDocumentCommand{\Verb}{ O{} m }{
    \ifblank{#1}{%
        \textoverset{#2}{\rsverb}
    }{%
        \textoverset{#2}{\rsverb, #1}
    }
}


\NewDocumentCommand{\Adverb}{ O{} m }{
    \ifblank{#1}{%
        \textoverset{#2}{\rsadv}
    }{%
        \textoverset{#2}{\rsadv, #1}
    }
}

\NewDocumentCommand{\Pretext}{ O{} m }{
    \ifblank{#1}{%
        \textoverset{#2}{\rsptxt}
    }{%
        \textoverset{#2}{\rsptxt, #1}
    }
}


\NewDocumentCommand{\Particle}{ O{} m }{
    \ifblank{#1}{%
        \textoverset{#2}{\rsptcl}
    }{%
        \textoverset{#2}{\rsptcl, #1}
    }
}



% \NewDocumentCommand{\Noun}{ m }{\textoverset{#1}{сущ.}}
% \NewDocumentCommand{\Pronoun}{ m }{\textoverset{#1}{мест.}}
% \NewDocumentCommand{\Verb}{ m }{\textoverset{#1}{глаг.}}
% \NewDocumentCommand{\Adjective}{ m }{\textoverset{#1}{прил.}}
% \NewDocumentCommand{\Particle}{ m }{\textoverset{#1}{част.}}
% \NewDocumentCommand{\Union}{ m }{\textoverset{#1}{союз}}
% \NewDocumentCommand{\Adverb}{ m }{\textoverset{#1}{нареч.}}
% \NewDocumentCommand{\Pretext}{ m }{\textoverset{#1}{предлог}}